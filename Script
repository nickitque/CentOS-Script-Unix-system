#1 configuring network to have ssh access
echo 'First step is going'
sed -i 's/ONBOOT=no/ONBOOT=yes/' /etc/sysconfig/network-scripts/ifcfg-enp0s3
service network restart
echo 'First step is ok'

#2 Restrict ssh connection
echo 'Second step is going'
sed -i 's/#PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config
echo 'Port 22' >> /etc/ssh/sshd_config
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
systemctl restart sshd
echo ' Second step is ok'

#3 Add local DVD ISO
echo 'Third step is going'
mkdir -p /cdrom
mount CentOS-7DVD.iso /cdrom
mv /etc/yum.repos.d/*.repo /tmp/
vi /etc/yum.repos.d/local.repo
echo '[LocalRepo]' >> etc/yum.repos.d/local.repo
echo 'name=LocalRepository' >> etc/yum.repos.d/local.repo
echo 'baseurl=file:///cdrom' >> etc/yum.repos.d/local.repo
echo 'enabled=1' >> etc/yum.repos.d/local.repo
echo 'gpgcheck=1' >> etc/yum.repos.d/local.repo
echo 'gpgkey=file:///etc/pki/rpg-gpg/RPM-GPG-KEY-CentOS-7 >> etc/yum.repos.d/local.repo
Echo 'Third step is ok'

#4 Setting up RAID5

echo 'Step four is going'
(echo n; echo p; echo 1; echo ; echo ; echo t; echo fd; echo w) | fdisk /dev/sdb
(echo n; echo p; echo 1; echo ; echo ; echo t; echo fd; echo w) | fdisk /dev/sdc
(echo n; echo p; echo 1; echo ; echo ; echo t; echo fd; echo w) | fdisk /dev/sdd
echo 'Fdisk operation is Done'

yum install mdadm -y
mdadm --create --verbose /dev/md5 --level=5 --raid-devices=3 /dev/sdb1 /dev/sdc1 /dev/sdd1
echo 'Mdadm is done'
lsblk
echo 'Four step is ok'

#5 Setting up LVM on RAID

echo 'Five step is going'
fdisk /dev/md5
pvcreate /dev/md5
vgcreate LVM-New /dev/md5
lvcreate -l +100%FREE -n LVM_data LVM-New
echo 'Five step is ok'

#6 XFS on LVM
echo 'Six step is going'
mkfs -t xfs /dev/LVM-New/LVM_data
echo 'Six step is ok'

#7 Mounting
echo 'Seven step is going'
mkdir /mounting
mount /dev/LVM-New/LVM_data /mounting
echo 'Seven step is ok'

#8 NFS
echo 'Eight step is going'
echo 'Installing nfs utilites'
sudo yum install nfs-utils
sudo systemctl start rpcbind
sudo systemctl enable rpcbind
sudo systemctl start nfs-server
sudo systemctl enable nfs-server
sudo systemctl start rpc-statd
sudo systemctl start nfs-idmapd
echo 'nfs utilites are installed'

echo 'making ISO dir'
mkdir /ISO
sudo chmod 777 /ISO
cat /etc/exports
/ISO *(rw,sync,no_root_squash)
echo 'ISO dir is created'

echo 'Enabling network ports'
mountd - 20048/udp, 20048/tcp
rpcbind - 111/udp, 111/tcp
nfs - 2049/udp, 2049/tcp
echo 'Network ports are enabled'
echo 'NFS utils install'
showmount -e "192.168.100.3"
Export list for "192.168.100.3":
/ISO *
echo 'NFS itils installed and NFS folders are shown'

echo 'Creating mount point'
mkdir /TEST
sudo mount -t nfs 192.168.100.3:/ISO /TEST
echo 'MP done'

echo 'Checking connection'
df -Th
echo 'Connection checked'
echo 'Eight step is done'
